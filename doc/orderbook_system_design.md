# 订单簿模式交易所核心系统设计要求

本设计要求文档总结了订单簿（Order Book）模式下，交易所核心系统的主要模块及其功能要求，适用于高并发、强一致性和高可用场景。

## 1. 交易撮合引擎（Matching Engine）
- 实现高效的买卖订单撮合，支持价格优先、时间优先等撮合规则。
- 支持多种订单类型（如限价单、市价单等）。
- 实时维护订单簿（买卖盘深度），保证撮合公平性和一致性。

## 2. 订单管理系统（Order Management System, OMS）
- 负责订单的接收、校验、入库、状态管理（新建、部分成交、全部成交、撤单等）。
- 支持订单的查询、撤销、修改等操作。
- 订单生命周期管理，保证订单状态一致性。

## 3. 行情推送（Market Data/Quote Service）
- 实时推送撮合后的成交行情、盘口深度、K线等市场数据。
- 支持 WebSocket、HTTP 等多种推送方式，满足高并发低延迟需求。

## 4. 风险控制模块（Risk Control）
- 下单前风控：如余额校验、限价保护、频率限制、黑名单等。
- 撮合后风控：如成交后资金划转、爆仓监控、异常检测等。
- 支持风控规则的灵活配置和动态调整。

## 5. 账户与资金管理（Account & Balance）
- 资金的冻结、解冻、划转、充值、提现等操作。
- 资金流水记录，保证账实一致。

## 6. 补偿与对账机制
- 关键流程落盘、补偿队列，防止消息丢失。
- 定期与外部系统（如清结算、钱包）对账，发现异常自动补偿。

## 7. 日志与监控
- 关键操作、异常、告警日志记录。
- 实时监控系统健康、撮合延迟、订单处理速率等指标。

## 8. API 接口层
- 提供 RESTful、WebSocket 等接口，供前端、第三方系统接入。

## 9. 其他要求
- 各模块需解耦，支持水平扩展。
- 关键路径需高可用、支持主备或多活部署。
- 需有完善的测试、回归和上线流程。

---
本设计要求为后续详细设计和开发提供指导，具体实现细节可参考《高并发撮合系统设计.md》《ws_engine_design.md》等文档。
